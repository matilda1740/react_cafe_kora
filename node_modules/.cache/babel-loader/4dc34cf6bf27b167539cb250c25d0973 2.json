{"ast":null,"code":"import { db, storage, time } from './firebase';\nconst customersRef = db.collection('user');\nconst productsRef = db.collection('product');\nconst ordersRef = db.collection('orders');\nexport const initialState = {\n  users: [],\n  products: [],\n  productUpdateStatus: [{\n    status: \"isIdle\",\n    message: \"\"\n  }, {\n    status: \"isSuccess\",\n    message: \"Product Update Successful!\"\n  }, {\n    status: \"isFailure\",\n    message: \"Product Update Failed!\"\n  }],\n  cart: []\n}; // USER FUNCTIONS\n\nexport const getTotalCustomers = customers => customers === null || customers === void 0 ? void 0 : customers.filter(customer => customer.type === \"customer\").length;\nexport const getTotalTeam = customers => customers === null || customers === void 0 ? void 0 : customers.filter(customer => customer.type === \"admin\").length; // CART FUNCTIONS\n\nexport const getSubTotal = cart => {\n  return cart === null || cart === void 0 ? void 0 : cart.reduce((amount, item) => item.quantity > 1 ? amount += parseInt(item.product_price * item.quantity) : amount += parseInt(item.product_price), 0);\n};\nexport const getproductTotal = cart => cart === null || cart === void 0 ? void 0 : cart.reduce((amount, item) => amount += parseInt(item.quantity), 0);\nexport const reducer = (prevState = initialState, action) => {\n  switch (action.type) {\n    //USER OPERATIONS\n    case \"fetch_users\":\n      let fetchedUsers = [...prevState.users]; // console.log(\"Fetch Users Action: \", action)\n\n      try {\n        customersRef.onSnapshot(snapshot => {\n          snapshot.docChanges().forEach(item => {\n            if (fetchedUsers.length === 0) {\n              fetchedUsers.push(item.doc.data());\n            } else {\n              let itemExists = fetchedUsers.findIndex(users => users.userID === item.doc.data().userID);\n\n              if (itemExists < 0) {\n                fetchedUsers.push(item.doc.data());\n              }\n            }\n          });\n        });\n      } catch (error) {\n        console.log(error);\n      }\n\n      return { ...prevState,\n        users: fetchedUsers\n      };\n\n    case \"delete_user\":\n      let copyUsers = [...prevState.users]; // console.log(\"Delete User Action: \", action)\n\n      try {\n        customersRef.where(\"userID\", \"==\", `${action.targetID}`).get().then(snapshot => {\n          snapshot.forEach(user => {\n            if (action.targetID) {\n              customersRef.doc(user.id).delete();\n              let userIndex = copyUsers.findIndex(current => current.userID === user.data().userID);\n\n              if (userIndex >= 0) {\n                copyUsers.splice(userIndex, 1);\n              }\n            }\n          });\n        }).catch(error => console.log(\"Deletion Error: \", error));\n      } catch (error) {\n        console.log(\"Deletion Error: \", error);\n      }\n\n      return { ...prevState,\n        users: copyUsers\n      };\n\n    case \"update_user\":\n      let updatedUser = [...prevState.users];\n      console.log(\"Update User: \", action);\n      return { ...prevState,\n        users: [...updatedUser]\n      };\n    //PRODUCT OPERATIONS\n\n    case \"add_product\":\n      let addProduct = [...prevState.products];\n      console.log(\"Add Action: \", action);\n\n      try {\n        const {\n          product_name,\n          product_descr,\n          product_cat,\n          product_price\n        } = action.updateData;\n        storage.ref(`/products/${product_cat}/${product_name}`).put(action.image, {\n          contentType: 'image/png'\n        }).on(\"state_changed\", snapshot => {\n          const prog = Math.round(snapshot.bytesTransferred / snapshot.totalBytes * 100); // setProgress(prog);\n          // console.log(snapshot, progress)\n        }, error => {\n          console.log(error);\n          alert(error.message);\n        }, () => {\n          storage.ref(`/products/${product_cat}/`).child(product_name).getDownloadURL().then(url => {\n            productsRef.add({\n              product_id: productsRef.doc().id,\n              product_name: product_name,\n              product_descr: product_descr,\n              product_image: url,\n              product_price: product_price,\n              product_cat: product_cat,\n              dateadded: time\n            });\n          }).catch(error => console.log(\"Error Adding Firestore Products: \", error));\n        });\n      } catch (error) {\n        console.log(\"Error Updating Storage: \", error);\n      }\n\n      return { ...prevState,\n        products: [...addProduct]\n      };\n\n    case \"update_product_info\":\n      let updateProducts = [...prevState.products];\n      console.log(\"Update Action: \", action);\n\n      try {\n        const {\n          product_name,\n          product_descr,\n          product_cat,\n          product_price\n        } = action.updateData;\n        storage.ref(`/products/${product_cat}/${product_name}`).put(action.image, {\n          contentType: 'image/png'\n        }).on(\"state_changed\", snapshot => {\n          const prog = Math.round(snapshot.bytesTransferred / snapshot.totalBytes * 100); // setProgress(prog);\n          // console.log(snapshot, progress)\n        }, error => {\n          console.log(error);\n          alert(error.message);\n        }, () => {\n          storage.ref(`/products/${product_cat}/`).child(product_name).getDownloadURL().then(url => {\n            productsRef.where(\"product_id\", \"==\", `${action.targetID}`).get().then(snapshot => {\n              snapshot.forEach(item => {\n                productsRef.doc(item.id).set({\n                  product_id: productsRef.doc().id,\n                  product_name: product_name,\n                  product_descr: product_descr,\n                  product_image: url,\n                  product_price: product_price,\n                  product_cat: product_cat,\n                  dateadded: time\n                }, {\n                  merge: true\n                });\n              });\n            });\n          }).catch(error => console.log(\"Error Adding Firestore Products: \", error));\n        });\n      } catch (error) {\n        console.log(\"Update Error: \", error);\n      }\n\n      return { ...prevState,\n        products: updateProducts\n      };\n\n    case \"delete_product\":\n      let copyProducts = [...prevState.products];\n\n      try {\n        productsRef.where(\"product_id\", \"==\", `${action.targetID}`).get().then(snapshot => {\n          snapshot.forEach(item => {\n            productsRef.doc(item.id).delete();\n            let prodIndex = copyProducts.findIndex(product => product.product_id === item.data().product_id);\n\n            if (prodIndex >= 0) {\n              copyProducts.splice(prodIndex, 1);\n            }\n          });\n        });\n      } catch (error) {\n        console.log(\"Deletion Error: \", error);\n      }\n\n      return { ...prevState,\n        products: copyProducts\n      };\n\n    case \"fetch_products\":\n      let fetchedProducts = [...prevState.products];\n\n      try {\n        productsRef.orderBy('product_name', 'asc').onSnapshot(snapshot => {\n          snapshot.docChanges().forEach(item => {\n            if (fetchedProducts.length === 0) {\n              fetchedProducts.push(item.doc.data());\n            } else {\n              let itemExists = fetchedProducts.findIndex(product => product.product_id === item.doc.data().product_id);\n\n              if (itemExists < 0) {\n                fetchedProducts.push(item.doc.data());\n              }\n            }\n          });\n        });\n      } catch (error) {\n        console.log(error);\n      }\n\n      return { ...prevState,\n        products: fetchedProducts\n      };\n    //CART OPERATIONS  \n\n    case \"add_to_cart\":\n      let addedCart = [...prevState.cart];\n      console.log(\"Add To Cart Action: \", action);\n\n      try {\n        let itemExists = addedCart.find(product => product.product_id === action.item.product_id);\n        !itemExists && addedCart.push({ ...action.item,\n          quantity: 1\n        });\n      } catch (error) {\n        console.log(\"Error Adding Item To Cart: \", error);\n      }\n\n      return { ...prevState,\n        cart: addedCart\n      };\n\n    case \"increase_qty\":\n      let increasedCart = [...prevState.cart];\n      console.log(\"Increase Qty Action: \", action);\n\n      try {\n        let productId = increasedCart.findIndex(product => product.product_id === action.item.product_id);\n        productId !== -1 ? increasedCart[productId].quantity += 1 : console.log(\"Error Increasing Quantity: \", productId);\n      } catch (error) {\n        console.log(error);\n      }\n\n      return { ...prevState,\n        cart: increasedCart\n      };\n\n    case \"decrease_qty\":\n      let currentCartCopy = [...prevState.cart];\n\n      try {\n        let itemExists = currentCartCopy.find(product => product.product_id === action.item.product_id);\n        itemExists.quantity <= 1 ? currentCartCopy.splice(prevState.cart.findIndex(item => item.id === action.item.product_id), 1) : itemExists.quantity = parseInt(itemExists.quantity) - 1;\n      } catch (error) {\n        console.log(error);\n      }\n\n      return { ...prevState,\n        cart: currentCartCopy\n      };\n\n    case \"fetch_cart\":\n      let fetchedCart = [...prevState.cart];\n      console.log(\"Fetch Cart Action: \", action);\n      return { ...prevState,\n        cart: fetchedCart\n      };\n\n    default:\n      return prevState;\n  }\n};","map":{"version":3,"sources":["/Users/matildamwendwa/Documents/Strathmore/Year 2/Web Application Dev/react_semester_project/src/components/reducer.js"],"names":["db","storage","time","customersRef","collection","productsRef","ordersRef","initialState","users","products","productUpdateStatus","status","message","cart","getTotalCustomers","customers","filter","customer","type","length","getTotalTeam","getSubTotal","reduce","amount","item","quantity","parseInt","product_price","getproductTotal","reducer","prevState","action","fetchedUsers","onSnapshot","snapshot","docChanges","forEach","push","doc","data","itemExists","findIndex","userID","error","console","log","copyUsers","where","targetID","get","then","user","id","delete","userIndex","current","splice","catch","updatedUser","addProduct","product_name","product_descr","product_cat","updateData","ref","put","image","contentType","on","prog","Math","round","bytesTransferred","totalBytes","alert","child","getDownloadURL","url","add","product_id","product_image","dateadded","updateProducts","set","merge","copyProducts","prodIndex","product","fetchedProducts","orderBy","addedCart","find","increasedCart","productId","currentCartCopy","fetchedCart"],"mappings":"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","sourcesContent":["\nimport { db, storage, time } from './firebase'\n\nconst customersRef = db.collection('user')\nconst productsRef = db.collection('product')\nconst ordersRef = db.collection('orders')\n\n\nexport const initialState = {\n    users: [],\n    products: [],\n    productUpdateStatus: [\n        {status: \"isIdle\", message: \"\"},\n        {status: \"isSuccess\", message: \"Product Update Successful!\"},\n        {status: \"isFailure\", message: \"Product Update Failed!\"},\n    ],\n    cart: []\n};\n// USER FUNCTIONS\nexport const getTotalCustomers = (customers) => customers?.filter(customer => customer.type === \"customer\").length\n \nexport const getTotalTeam = (customers) => customers?.filter(customer => customer.type === \"admin\").length\n// CART FUNCTIONS\nexport const getSubTotal = (cart) => {\n  return cart?.reduce((amount, item) => item.quantity > 1 ? amount+=parseInt(item.product_price * item.quantity) :amount+=parseInt(item.product_price), 0)   \n}\nexport const getproductTotal = (cart) => cart?.reduce((amount, item) => amount+=parseInt(item.quantity), 0)\n\n\nexport const reducer = (prevState = initialState, action) => {\n    switch(action.type) {\n\n//USER OPERATIONS\n        case \"fetch_users\": \n            let fetchedUsers = [...prevState.users]\n            // console.log(\"Fetch Users Action: \", action)\n            try{\n                customersRef \n                .onSnapshot((snapshot) => {\n                    snapshot.docChanges().forEach( item => {\n                        if(fetchedUsers.length === 0){\n                            fetchedUsers.push(item.doc.data())\n                        }else{\n                            let itemExists = fetchedUsers.findIndex( users => users.userID === item.doc.data().userID)\n                            if(itemExists < 0){\n                                fetchedUsers.push(item.doc.data())\n                            }\n                        }\n                    })\n                })\n            }catch(error){\n                console.log(error)\n            }            \n            return {\n                 ...prevState, \n                users: fetchedUsers         \n            }\n\n        case \"delete_user\": \n            let copyUsers = [...prevState.users]\n            // console.log(\"Delete User Action: \", action)\n             try{ \n                customersRef\n                    .where(\"userID\", \"==\", `${action.targetID}`)\n                    .get()\n                    .then( snapshot => {\n                        snapshot.forEach( user => {\n                            if(action.targetID){\n                                customersRef.doc(user.id).delete() \n                                let userIndex = copyUsers.findIndex( current => current.userID === user.data().userID)  \n                                if (userIndex >= 0) {\n                                copyUsers.splice(userIndex, 1);\n                                }                              \n                            }\n                        })\n                    })\n                    .catch(error => console.log(\"Deletion Error: \", error))         \n            }catch(error){\n                console.log(\"Deletion Error: \", error)\n            }           \n            return {\n                 ...prevState, \n                users: copyUsers          \n            }\n        case \"update_user\": \n\n            let updatedUser = [...prevState.users]\n            console.log(\"Update User: \", action)\n            return {\n                 ...prevState, \n                users: [...updatedUser]            \n            }\n//PRODUCT OPERATIONS\n        case \"add_product\": \n\n            let addProduct = [...prevState.products]\n            console.log(\"Add Action: \" ,action)\n            try{\n                const { product_name, product_descr, product_cat, product_price } = action.updateData\n\n                storage\n                    .ref(`/products/${product_cat}/${product_name}`)\n                    .put(action.image, {contentType: 'image/png'},)\n                    .on(\"state_changed\" , \n                        (snapshot) => {\n                        const prog = Math.round(\n                        (snapshot.bytesTransferred / snapshot.totalBytes) *  100\n                        );\n                        // setProgress(prog);\n                        // console.log(snapshot, progress)\n                    },\n                    (error) => {\n                        console.log(error);\n                        alert(error.message);\n                    },\n                    () => {\n                        storage\n                        .ref(`/products/${product_cat}/`)\n                        .child(product_name)\n                        .getDownloadURL()\n                        .then((url) => {\n                            productsRef.add({\n                                product_id: productsRef.doc().id,\n                                product_name: product_name,\n                                product_descr : product_descr,\n                                product_image: url,\n                                product_price: product_price,\n                                product_cat: product_cat,\n                                dateadded: time,\n                                })\n                        })                  \n                        .catch( error => console.log(\"Error Adding Firestore Products: \", error))\n                        }\n                    )\n            }catch(error){\n                console.log(\"Error Updating Storage: \", error)\n            }\n\n            return {\n                 ...prevState, \n                products: [...addProduct]            \n            }     \n\n        case \"update_product_info\":\n            let updateProducts = [...prevState.products]\n            console.log(\"Update Action: \" ,action)\n            try {\n                const { product_name, product_descr, product_cat, product_price } = action.updateData\n\n                storage\n                    .ref(`/products/${product_cat}/${product_name}`)\n                    .put(action.image, {contentType: 'image/png'},)\n                    .on(\"state_changed\" , \n                        (snapshot) => {\n                        const prog = Math.round(\n                        (snapshot.bytesTransferred / snapshot.totalBytes) *  100\n                        );\n                        // setProgress(prog);\n                        // console.log(snapshot, progress)\n                    },\n                    (error) => {\n                        console.log(error);\n                        alert(error.message);\n                    },\n                    () => {\n                        storage\n                        .ref(`/products/${product_cat}/`)\n                        .child(product_name)\n                        .getDownloadURL()\n                        .then((url) => {\n                        productsRef\n                            .where(\"product_id\", \"==\", `${action.targetID}`)\n                            .get()\n                            .then( snapshot => {\n                                snapshot.forEach( item => {\n                                    productsRef\n                                        .doc(item.id)\n                                        .set({\n                                                product_id: productsRef.doc().id,\n                                                product_name: product_name,\n                                                product_descr : product_descr,\n                                                product_image: url,\n                                                product_price: product_price,\n                                                product_cat: product_cat,\n                                                dateadded: time,\n                                        }\n                                        , {merge: true})\n                                })\n                            })\n                        })                  \n                        .catch( error => console.log(\"Error Adding Firestore Products: \", error))                        \n\n                    } \n                    )               \n            }catch(error){\n                console.log(\"Update Error: \", error)\n            }\n            return {\n                ...prevState, \n                products: updateProducts  \n            }\n\n        case \"delete_product\":\n            let copyProducts =  [...prevState.products];\n            try{ \n                productsRef\n                    .where(\"product_id\", \"==\", `${action.targetID}`)\n                    .get()\n                    .then( snapshot => {\n                        snapshot.forEach( item => {\n                            productsRef.doc(item.id).delete() \n                            let prodIndex = copyProducts.findIndex( product => product.product_id === item.data().product_id)  \n                            if (prodIndex >= 0) {\n                               copyProducts.splice(prodIndex, 1);\n                            }                           \n                        })\n                    })\n            }catch(error){\n                console.log(\"Deletion Error: \", error)\n            }            \n            return {\n                ...prevState, \n                products: copyProducts              \n            }\n\n        case \"fetch_products\":\n            let fetchedProducts = [...prevState.products];\n            try{\n                productsRef \n                .orderBy('product_name', 'asc')\n                .onSnapshot((snapshot) => {\n                    snapshot.docChanges().forEach( item => {\n                        if(fetchedProducts.length === 0){\n                            fetchedProducts.push(item.doc.data())\n                        }else{\n                            let itemExists = fetchedProducts.findIndex( product => product.product_id === item.doc.data().product_id)\n\n                            if(itemExists < 0){\n                                fetchedProducts.push(item.doc.data())\n                            }\n                        }\n                    })\n                })\n            }catch(error){\n                console.log(error)\n            }\n            return{\n                ...prevState, \n                products: fetchedProducts,\n            }\n//CART OPERATIONS  \n        case \"add_to_cart\": \n            let addedCart = [...prevState.cart]\n            console.log(\"Add To Cart Action: \", action)\n\n            try {\n                let itemExists = addedCart.find( product => product.product_id === action.item.product_id);\n                !itemExists && addedCart.push({...action.item, quantity: 1}) \n            \n            }catch(error){\n                console.log(\"Error Adding Item To Cart: \", error)\n            }\n            return {\n                 ...prevState, \n                cart: addedCart         \n            }  \n        case \"increase_qty\": \n            let increasedCart = [...prevState.cart]; \n            console.log(\"Increase Qty Action: \", action)\n            try{\n                let productId = increasedCart.findIndex(product => product.product_id === action.item.product_id)\n                productId !== -1 ? increasedCart[productId].quantity +=1\n                : console.log(\"Error Increasing Quantity: \", productId);\n               \n            }catch(error){\n                console.log(error);\n            }\n            return {\n                ...prevState,\n                cart: increasedCart\n            };\n        case \"decrease_qty\":\n            let currentCartCopy = [...prevState.cart]; \n            try{\n                let itemExists = currentCartCopy.find( product => product.product_id === action.item.product_id);\n\n                itemExists.quantity <= 1 ? \n                     currentCartCopy.splice(prevState.cart.findIndex( item  => item.id === action.item.product_id), 1)\n                    :itemExists.quantity = parseInt(itemExists.quantity) - 1\n                \n            }catch(error){\n                console.log(error);\n            }\n            return {\n                ...prevState,\n                cart: currentCartCopy\n            };            \n        case \"fetch_cart\": \n            let fetchedCart = [...prevState.cart]\n            console.log(\"Fetch Cart Action: \", action)\n            return {\n                 ...prevState, \n                cart: fetchedCart          \n            }  \n        default: \n            return prevState;\n    }\n}\n\n"]},"metadata":{},"sourceType":"module"}