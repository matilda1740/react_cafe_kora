{"ast":null,"code":"import { db } from './firebase';\nexport const initialState = {\n  users: [],\n  products: []\n};\nexport const reducer = (prevState = initialState, action) => {\n  const customersRef = db.collection('user');\n  const productsRef = db.collection('product');\n\n  switch (action.type) {\n    case \"delete_product\":\n      let copyProducts = [...prevState.products];\n      console.log(action);\n\n      try {\n        customersRef.where(\"userID\", \"==\", `${action.targetID}`).get().then(snapshot => {\n          console.log(snapshot.data());\n          snapshot.forEach(item => {\n            console.log(item); // productsRef.doc(item.id).delete() \n          });\n        }).then(() => {\n          let filtered = copyProducts.filter(product => product.product_id !== action.targetID);\n          copyProducts = filtered;\n          return copyProducts;\n        }).catch(error => console.log(\"Deletion Error: \", error));\n      } catch (error) {\n        console.log(\"Deletion Error: \", error);\n      }\n\n      return { ...prevState,\n        products: copyProducts\n      };\n\n    case \"fetch_products\":\n      let fetchedProducts = [...prevState.products];\n\n      try {\n        productsRef.onSnapshot(snapshot => {\n          snapshot.docs.forEach(item => {\n            // fetchedProducts = [...prevState.products]\n            if ((fetchedProducts === null || fetchedProducts === void 0 ? void 0 : fetchedProducts.length) === 0) {\n              return fetchedProducts.push(item.data());\n            } else {\n              let itemExists = fetchedProducts.findIndex(product => product.product_id === item.data().product_id);\n\n              if (itemExists < 0) {\n                return fetchedProducts.push(item.data());\n              }\n            }\n          });\n        });\n      } catch (error) {\n        console.log(error);\n      }\n\n      return { ...prevState,\n        products: fetchedProducts // products: [...fetchedProducts],\n\n      };\n\n    case \"fetch_user_details\":\n      let copyUsers = [...prevState.users];\n      let selectedUser;\n      customersRef.where(\"userID\", \"==\", `${action.targetID}`).get().then(snapshot => {\n        snapshot.forEach(user => {\n          selectedUser = user.data();\n          return selectedUser;\n        });\n      }).catch(error => console.log(\"Update Error: \", error));\n      console.log(action, selectedUser);\n      return { ...prevState,\n        users: copyUsers\n      };\n\n    default:\n      return prevState;\n  } // return prevState;\n\n};","map":{"version":3,"sources":["/Users/matildamwendwa/Documents/Strathmore/Year 2/Web Application Dev/react_semester_project/src/components/reducer.js"],"names":["db","initialState","users","products","reducer","prevState","action","customersRef","collection","productsRef","type","copyProducts","console","log","where","targetID","get","then","snapshot","data","forEach","item","filtered","filter","product","product_id","catch","error","fetchedProducts","onSnapshot","docs","length","push","itemExists","findIndex","copyUsers","selectedUser","user"],"mappings":"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","sourcesContent":["\nimport { db } from './firebase'\n\nexport const initialState = {\n    users: [],\n    products: []\n\n};\n\n\nexport const reducer = (prevState = initialState, action) => {\n    const customersRef = db.collection('user')\n    const productsRef = db.collection('product')\n\n\n    switch(action.type) {\n\n        case \"delete_product\" :\n            let copyProducts =  [...prevState.products];\n            console.log(action)\n            try{ \n                customersRef\n                    .where(\"userID\", \"==\", `${action.targetID}`)\n                    .get()\n                    .then( snapshot => {\n                        console.log(snapshot.data())\n                        snapshot.forEach( item => {\n                            console.log(item)\n                            // productsRef.doc(item.id).delete() \n                        })\n                    })\n                    .then( () => {\n                        let filtered = copyProducts.filter( product => product.product_id !== action.targetID);\n\n                        copyProducts = filtered\n                        return copyProducts;\n                    })\n                    .catch(error => console.log(\"Deletion Error: \", error))   \n                    \n                    \n            }catch(error){\n                console.log(\"Deletion Error: \", error)\n            }            \n            return {\n                ...prevState, \n                products: copyProducts,                \n            }\n        case \"fetch_products\":\n            let fetchedProducts = [...prevState.products];\n            try{\n                productsRef \n                .onSnapshot((snapshot) => {\n                    snapshot.docs.forEach( item => {\n                        // fetchedProducts = [...prevState.products]\n                        if(fetchedProducts?.length === 0){\n                            return fetchedProducts.push(item.data())\n                        }else{\n                            let itemExists = fetchedProducts.findIndex( product => product.product_id === item.data().product_id)\n\n                            if(itemExists < 0){\n                                return fetchedProducts.push(item.data())\n                            }\n                        }\n                    })\n                })\n            }catch(error){\n                console.log(error)\n            }\n            return{\n                ...prevState, \n                products: fetchedProducts,\n                // products: [...fetchedProducts],\n            }\n\n        case \"fetch_user_details\":\n            let copyUsers = [...prevState.users]\n\n            let selectedUser;\n            customersRef\n                .where(\"userID\", \"==\", `${action.targetID}`)\n                    .get()\n                    .then( snapshot => {\n                        snapshot.forEach( user => {\n                            selectedUser = user.data()\n                            return selectedUser\n                        })\n                    })\n                    .catch( (error) => console.log(\"Update Error: \", error))\n            console.log(action, selectedUser)\n            return{\n                ...prevState,\n                users: copyUsers,\n            }\n\n\n        default: \n            return prevState;\n    }\n            // return prevState;\n\n}\n\n"]},"metadata":{},"sourceType":"module"}