{"ast":null,"code":"import { db } from './firebase';\nexport const initialState = {\n  users: [],\n  products: []\n};\nexport const reducer = (prevState = initialState, action) => {\n  const customersRef = db.collection('user');\n  const productsRef = db.collection('product');\n\n  switch (action.type) {\n    case \"update_user\":\n      let updatedUser = [...prevState.users];\n      console.log(action);\n      return { ...prevState,\n        users: [...updatedUser]\n      };\n\n    case \"delete_user\":\n      let deleteUser = [...prevState.users];\n      return { ...prevState,\n        users: [...deleteUser]\n      };\n\n    case \"add_product\":\n      let addProduct = [...prevState.products];\n      console.log(action);\n      return { ...prevState,\n        products: [...addProduct]\n      };\n\n    case \"update_product_info\":\n      let updateProducts = [...prevState.products];\n      console.log(action);\n\n      try {\n        productsRef.where(\"product_id\", \"==\", `${action.targetID}`).get().then(snapshot => {\n          snapshot.forEach(item => {\n            productsRef.doc(item.id).set({ ...action.updateData\n            });\n          });\n        }).catch(error => console.log(error));\n      } catch (error) {\n        console.log(\"Update Error: \", error);\n      }\n\n      return { ...prevState,\n        products: updateProducts\n      };\n\n    case \"delete_product\":\n      let copyProducts = [...prevState.products];\n\n      try {\n        productsRef.where(\"product_id\", \"==\", `${action.targetID}`).get().then(snapshot => {\n          snapshot.forEach(item => {\n            productsRef.doc(item.id).delete();\n            let prodIndex = copyProducts.findIndex(product => product.product_id === item.data().product_id);\n\n            if (prodIndex >= 0) {\n              copyProducts.splice(prodIndex, 1);\n            }\n          });\n          console.log(copyProducts);\n        }).catch(error => console.log(error));\n      } catch (error) {\n        console.log(\"Deletion Error: \", error);\n      }\n\n      return { ...prevState,\n        products: copyProducts\n      };\n\n    case \"fetch_products\":\n      let fetchedProducts = [...prevState.products];\n\n      try {\n        productsRef.onSnapshot(snapshot => {\n          snapshot.docChanges().forEach(item => {\n            if (fetchedProducts.length === 0) {\n              fetchedProducts.push(item.doc.data());\n            } else {\n              let itemExists = fetchedProducts.findIndex(product => product.product_id === item.doc.data().product_id);\n\n              if (itemExists < 0) {\n                fetchedProducts.push(item.doc.data());\n              }\n            }\n          });\n        });\n      } catch (error) {\n        console.log(error);\n      }\n\n      return { ...prevState,\n        products: fetchedProducts // products: [...fetchedProducts],\n\n      };\n\n    case \"fetch_user_details\":\n      let copyUsers = [...prevState.users];\n      let selectedUser;\n      customersRef.where(\"userID\", \"==\", `${action.targetID}`).get().then(snapshot => {\n        snapshot.forEach(user => {\n          selectedUser = user.data();\n          return selectedUser;\n        });\n      }).catch(error => console.log(\"Update Error: \", error));\n      console.log(action, selectedUser);\n      return { ...prevState,\n        users: copyUsers\n      };\n\n    default:\n      return prevState;\n  }\n};","map":{"version":3,"sources":["/Users/matildamwendwa/Documents/Strathmore/Year 2/Web Application Dev/react_semester_project/src/components/reducer.js"],"names":["db","initialState","users","products","reducer","prevState","action","customersRef","collection","productsRef","type","updatedUser","console","log","deleteUser","addProduct","updateProducts","where","targetID","get","then","snapshot","forEach","item","doc","id","set","updateData","catch","error","copyProducts","delete","prodIndex","findIndex","product","product_id","data","splice","fetchedProducts","onSnapshot","docChanges","length","push","itemExists","copyUsers","selectedUser","user"],"mappings":"AACA,SAASA,EAAT,QAAmB,YAAnB;AAEA,OAAO,MAAMC,YAAY,GAAG;AACxBC,EAAAA,KAAK,EAAE,EADiB;AAExBC,EAAAA,QAAQ,EAAE;AAFc,CAArB;AAOP,OAAO,MAAMC,OAAO,GAAG,CAACC,SAAS,GAAGJ,YAAb,EAA2BK,MAA3B,KAAsC;AACzD,QAAMC,YAAY,GAAGP,EAAE,CAACQ,UAAH,CAAc,MAAd,CAArB;AACA,QAAMC,WAAW,GAAGT,EAAE,CAACQ,UAAH,CAAc,SAAd,CAApB;;AAEA,UAAOF,MAAM,CAACI,IAAd;AAEI,SAAK,aAAL;AAEI,UAAIC,WAAW,GAAG,CAAC,GAAGN,SAAS,CAACH,KAAd,CAAlB;AACAU,MAAAA,OAAO,CAACC,GAAR,CAAYP,MAAZ;AACA,aAAO,EACF,GAAGD,SADD;AAEHH,QAAAA,KAAK,EAAE,CAAC,GAAGS,WAAJ;AAFJ,OAAP;;AAIJ,SAAK,aAAL;AAEI,UAAIG,UAAU,GAAG,CAAC,GAAGT,SAAS,CAACH,KAAd,CAAjB;AACA,aAAO,EACF,GAAGG,SADD;AAEHH,QAAAA,KAAK,EAAE,CAAC,GAAGY,UAAJ;AAFJ,OAAP;;AAKJ,SAAK,aAAL;AAEI,UAAIC,UAAU,GAAG,CAAC,GAAGV,SAAS,CAACF,QAAd,CAAjB;AACAS,MAAAA,OAAO,CAACC,GAAR,CAAYP,MAAZ;AACA,aAAO,EACF,GAAGD,SADD;AAEHF,QAAAA,QAAQ,EAAE,CAAC,GAAGY,UAAJ;AAFP,OAAP;;AAIJ,SAAK,qBAAL;AACI,UAAIC,cAAc,GAAG,CAAC,GAAGX,SAAS,CAACF,QAAd,CAArB;AACAS,MAAAA,OAAO,CAACC,GAAR,CAAYP,MAAZ;;AAEA,UAAI;AACAG,QAAAA,WAAW,CACNQ,KADL,CACW,YADX,EACyB,IADzB,EACgC,GAAEX,MAAM,CAACY,QAAS,EADlD,EAEKC,GAFL,GAGKC,IAHL,CAGWC,QAAQ,IAAI;AACfA,UAAAA,QAAQ,CAACC,OAAT,CAAkBC,IAAI,IAAI;AACtBd,YAAAA,WAAW,CACNe,GADL,CACSD,IAAI,CAACE,EADd,EAEKC,GAFL,CAES,EACD,GAAGpB,MAAM,CAACqB;AADT,aAFT;AAKH,WAND;AAOH,SAXL,EAYKC,KAZL,CAYYC,KAAK,IAAIjB,OAAO,CAACC,GAAR,CAAYgB,KAAZ,CAZrB;AAeH,OAhBD,CAgBC,OAAMA,KAAN,EAAY;AACTjB,QAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BgB,KAA9B;AACH;;AACD,aAAO,EACH,GAAGxB,SADA;AAEHF,QAAAA,QAAQ,EAAEa;AAFP,OAAP;;AAIJ,SAAK,gBAAL;AACI,UAAIc,YAAY,GAAI,CAAC,GAAGzB,SAAS,CAACF,QAAd,CAApB;;AACA,UAAG;AACCM,QAAAA,WAAW,CACNQ,KADL,CACW,YADX,EACyB,IADzB,EACgC,GAAEX,MAAM,CAACY,QAAS,EADlD,EAEKC,GAFL,GAGKC,IAHL,CAGWC,QAAQ,IAAI;AACfA,UAAAA,QAAQ,CAACC,OAAT,CAAkBC,IAAI,IAAI;AACtBd,YAAAA,WAAW,CAACe,GAAZ,CAAgBD,IAAI,CAACE,EAArB,EAAyBM,MAAzB;AACA,gBAAIC,SAAS,GAAGF,YAAY,CAACG,SAAb,CAAwBC,OAAO,IAAIA,OAAO,CAACC,UAAR,KAAsBZ,IAAI,CAACa,IAAL,GAAYD,UAArE,CAAhB;;AACA,gBAAIH,SAAS,IAAI,CAAjB,EAAoB;AACjBF,cAAAA,YAAY,CAACO,MAAb,CAAoBL,SAApB,EAA+B,CAA/B;AACF;AACJ,WAND;AAOApB,UAAAA,OAAO,CAACC,GAAR,CAAYiB,YAAZ;AACH,SAZL,EAYOF,KAZP,CAYcC,KAAK,IAAIjB,OAAO,CAACC,GAAR,CAAYgB,KAAZ,CAZvB;AAeH,OAhBD,CAgBC,OAAMA,KAAN,EAAY;AACTjB,QAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgCgB,KAAhC;AACH;;AACD,aAAO,EACH,GAAGxB,SADA;AAEHF,QAAAA,QAAQ,EAAE2B;AAFP,OAAP;;AAKJ,SAAK,gBAAL;AACI,UAAIQ,eAAe,GAAG,CAAC,GAAGjC,SAAS,CAACF,QAAd,CAAtB;;AACA,UAAG;AACCM,QAAAA,WAAW,CACV8B,UADD,CACalB,QAAD,IAAc;AACtBA,UAAAA,QAAQ,CAACmB,UAAT,GAAsBlB,OAAtB,CAA+BC,IAAI,IAAI;AACnC,gBAAGe,eAAe,CAACG,MAAhB,KAA2B,CAA9B,EAAgC;AAC5BH,cAAAA,eAAe,CAACI,IAAhB,CAAqBnB,IAAI,CAACC,GAAL,CAASY,IAAT,EAArB;AACH,aAFD,MAEK;AACD,kBAAIO,UAAU,GAAGL,eAAe,CAACL,SAAhB,CAA2BC,OAAO,IAAIA,OAAO,CAACC,UAAR,KAAuBZ,IAAI,CAACC,GAAL,CAASY,IAAT,GAAgBD,UAA7E,CAAjB;;AAEA,kBAAGQ,UAAU,GAAG,CAAhB,EAAkB;AACdL,gBAAAA,eAAe,CAACI,IAAhB,CAAqBnB,IAAI,CAACC,GAAL,CAASY,IAAT,EAArB;AACH;AACJ;AACJ,WAVD;AAWH,SAbD;AAcH,OAfD,CAeC,OAAMP,KAAN,EAAY;AACTjB,QAAAA,OAAO,CAACC,GAAR,CAAYgB,KAAZ;AACH;;AACD,aAAM,EACF,GAAGxB,SADD;AAEFF,QAAAA,QAAQ,EAAEmC,eAFR,CAGF;;AAHE,OAAN;;AAMJ,SAAK,oBAAL;AACI,UAAIM,SAAS,GAAG,CAAC,GAAGvC,SAAS,CAACH,KAAd,CAAhB;AAEA,UAAI2C,YAAJ;AACAtC,MAAAA,YAAY,CACPU,KADL,CACW,QADX,EACqB,IADrB,EAC4B,GAAEX,MAAM,CAACY,QAAS,EAD9C,EAESC,GAFT,GAGSC,IAHT,CAGeC,QAAQ,IAAI;AACfA,QAAAA,QAAQ,CAACC,OAAT,CAAkBwB,IAAI,IAAI;AACtBD,UAAAA,YAAY,GAAGC,IAAI,CAACV,IAAL,EAAf;AACA,iBAAOS,YAAP;AACH,SAHD;AAIH,OART,EASSjB,KATT,CASiBC,KAAD,IAAWjB,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BgB,KAA9B,CAT3B;AAUAjB,MAAAA,OAAO,CAACC,GAAR,CAAYP,MAAZ,EAAoBuC,YAApB;AACA,aAAM,EACF,GAAGxC,SADD;AAEFH,QAAAA,KAAK,EAAE0C;AAFL,OAAN;;AAIJ;AACI,aAAOvC,SAAP;AA7HR;AA+HH,CAnIM","sourcesContent":["\nimport { db } from './firebase'\n\nexport const initialState = {\n    users: [],\n    products: []\n\n};\n\n\nexport const reducer = (prevState = initialState, action) => {\n    const customersRef = db.collection('user')\n    const productsRef = db.collection('product')\n\n    switch(action.type) {\n\n        case \"update_user\": \n\n            let updatedUser = [...prevState.users]\n            console.log(action)\n            return {\n                 ...prevState, \n                users: [...updatedUser]            \n            }\n        case \"delete_user\": \n\n            let deleteUser = [...prevState.users]\n            return {\n                 ...prevState, \n                users: [...deleteUser]            \n            }\n\n        case \"add_product\": \n\n            let addProduct = [...prevState.products]\n            console.log(action)\n            return {\n                 ...prevState, \n                products: [...addProduct]            \n            }            \n        case \"update_product_info\":\n            let updateProducts = [...prevState.products]\n            console.log(action)\n\n            try {\n                productsRef\n                    .where(\"product_id\", \"==\", `${action.targetID}`)\n                    .get()\n                    .then( snapshot => {\n                        snapshot.forEach( item => {\n                            productsRef\n                                .doc(item.id)\n                                .set({\n                                    ...action.updateData\n                                })\n                        })\n                    })\n                    .catch( error => console.log(error))\n\n\n            }catch(error){\n                console.log(\"Update Error: \", error)\n            }\n            return {\n                ...prevState, \n                products: updateProducts  \n            }\n        case \"delete_product\":\n            let copyProducts =  [...prevState.products];\n            try{ \n                productsRef\n                    .where(\"product_id\", \"==\", `${action.targetID}`)\n                    .get()\n                    .then( snapshot => {\n                        snapshot.forEach( item => {\n                            productsRef.doc(item.id).delete() \n                            let prodIndex = copyProducts.findIndex( product => product.product_id ===item.data().product_id)  \n                            if (prodIndex >= 0) {\n                               copyProducts.splice(prodIndex, 1);\n                            }                           \n                        })\n                        console.log(copyProducts)\n                    }).catch( error => console.log(error))\n                    \n                    \n            }catch(error){\n                console.log(\"Deletion Error: \", error)\n            }            \n            return {\n                ...prevState, \n                products: copyProducts              \n            }\n\n        case \"fetch_products\":\n            let fetchedProducts = [...prevState.products];\n            try{\n                productsRef \n                .onSnapshot((snapshot) => {\n                    snapshot.docChanges().forEach( item => {\n                        if(fetchedProducts.length === 0){\n                            fetchedProducts.push(item.doc.data())\n                        }else{\n                            let itemExists = fetchedProducts.findIndex( product => product.product_id === item.doc.data().product_id)\n\n                            if(itemExists < 0){\n                                fetchedProducts.push(item.doc.data())\n                            }\n                        }\n                    })\n                })\n            }catch(error){\n                console.log(error)\n            }\n            return{\n                ...prevState, \n                products: fetchedProducts,\n                // products: [...fetchedProducts],\n            }\n\n        case \"fetch_user_details\":\n            let copyUsers = [...prevState.users]\n\n            let selectedUser;\n            customersRef\n                .where(\"userID\", \"==\", `${action.targetID}`)\n                    .get()\n                    .then( snapshot => {\n                        snapshot.forEach( user => {\n                            selectedUser = user.data()\n                            return selectedUser\n                        })\n                    })\n                    .catch( (error) => console.log(\"Update Error: \", error))\n            console.log(action, selectedUser)\n            return{\n                ...prevState,\n                users: copyUsers,\n            }\n        default: \n            return prevState;\n    }\n}\n\n"]},"metadata":{},"sourceType":"module"}